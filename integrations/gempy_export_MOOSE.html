
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Export a geological model from GemPy to use in MOOSE &#8212; GemPy 2.2.8 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transform 2019: Integrating Striplog and GemPy" href="gempy_striplog.html" />
    <link rel="prev" title="Integrations" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-integrations-gempy-export-moose-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="export-a-geological-model-from-gempy-to-use-in-moose">
<span id="sphx-glr-integrations-gempy-export-moose-py"></span><h1>Export a geological model from GemPy to use in MOOSE<a class="headerlink" href="#export-a-geological-model-from-gempy-to-use-in-moose" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gempy</span> <span class="k">as</span> <span class="nn">gp</span>
</pre></div>
</div>
<div class="section" id="creating-a-geological-model">
<h2>Creating a geological model<a class="headerlink" href="#creating-a-geological-model" title="Permalink to this headline">¶</a></h2>
<p>The procedure of generating a geological model is presented in detail in
<a class="reference external" href="https://nbviewer.jupyter.org/github/cgre-aachen/gempy/blob/master/notebooks/tutorials/ch1-1_Basics.ipynb">Chapter
1-1</a>
of the GemPy tutorials, so it will only be briefly presented here</p>
<p>Initiate a model</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a> <span class="o">=</span> <a href="../GemPy API/gempy.create_model.html#gempy.create_model" title="gempy.create_model" class="sphx-glr-backref-module-gempy sphx-glr-backref-type-py-function"><span class="n">gp</span><span class="o">.</span><span class="n">create_model</span></a><span class="p">(</span><span class="s1">&#39;tutorial_moose_exp&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_path</span></a> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/cgre-aachen/gempy_data/master/&#39;</span>
</pre></div>
</div>
<p>Import data from CSV-files with setting the resolution and model extent</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../GemPy API/gempy.init_data.html#gempy.init_data" title="gempy.init_data" class="sphx-glr-backref-module-gempy sphx-glr-backref-type-py-function"><span class="n">gp</span><span class="o">.</span><span class="n">init_data</span></a><span class="p">(</span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>
             <span class="n">path_o</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_path</span></a> <span class="o">+</span> <span class="s2">&quot;/data/input_data/tut_chapter1/simple_fault_model_orientations.csv&quot;</span><span class="p">,</span>
             <span class="n">path_i</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">data_path</span></a> <span class="o">+</span> <span class="s2">&quot;/data/input_data/tut_chapter1/simple_fault_model_points.csv&quot;</span><span class="p">,</span>
             <span class="n">default_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Active grids: [&#39;regular&#39;]

tutorial_moose_exp  2021-04-18 11:39
</pre></div>
</div>
<p>present the units and series</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../Model/gempy.core.model.ImplicitCoKriging.html#gempy.core.model.ImplicitCoKriging.surfaces" title="gempy.core.model.ImplicitCoKriging.surfaces" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-method"><span class="n">geo_model</span><span class="o">.</span><span class="n">surfaces</span></a>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<style  type="text/css" >
#T_7b74d_row0_col3{
            background-color:  #015482;
        }#T_7b74d_row1_col3{
            background-color:  #9f0052;
        }#T_7b74d_row2_col3{
            background-color:  #ffbe00;
        }#T_7b74d_row3_col3{
            background-color:  #728f02;
        }#T_7b74d_row4_col3{
            background-color:  #443988;
        }#T_7b74d_row5_col3{
            background-color:  #ff3f20;
        }</style><table id="T_7b74d_" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >surface</th>        <th class="col_heading level0 col1" >series</th>        <th class="col_heading level0 col2" >order_surfaces</th>        <th class="col_heading level0 col3" >color</th>        <th class="col_heading level0 col4" >id</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_7b74d_level0_row0" class="row_heading level0 row0" >0</th>
                        <td id="T_7b74d_row0_col0" class="data row0 col0" >Shale</td>
                        <td id="T_7b74d_row0_col1" class="data row0 col1" >Default series</td>
                        <td id="T_7b74d_row0_col2" class="data row0 col2" >1</td>
                        <td id="T_7b74d_row0_col3" class="data row0 col3" >#015482</td>
                        <td id="T_7b74d_row0_col4" class="data row0 col4" >1</td>
            </tr>
            <tr>
                        <th id="T_7b74d_level0_row1" class="row_heading level0 row1" >1</th>
                        <td id="T_7b74d_row1_col0" class="data row1 col0" >Sandstone_1</td>
                        <td id="T_7b74d_row1_col1" class="data row1 col1" >Default series</td>
                        <td id="T_7b74d_row1_col2" class="data row1 col2" >2</td>
                        <td id="T_7b74d_row1_col3" class="data row1 col3" >#9f0052</td>
                        <td id="T_7b74d_row1_col4" class="data row1 col4" >2</td>
            </tr>
            <tr>
                        <th id="T_7b74d_level0_row2" class="row_heading level0 row2" >2</th>
                        <td id="T_7b74d_row2_col0" class="data row2 col0" >Siltstone</td>
                        <td id="T_7b74d_row2_col1" class="data row2 col1" >Default series</td>
                        <td id="T_7b74d_row2_col2" class="data row2 col2" >3</td>
                        <td id="T_7b74d_row2_col3" class="data row2 col3" >#ffbe00</td>
                        <td id="T_7b74d_row2_col4" class="data row2 col4" >3</td>
            </tr>
            <tr>
                        <th id="T_7b74d_level0_row3" class="row_heading level0 row3" >3</th>
                        <td id="T_7b74d_row3_col0" class="data row3 col0" >Sandstone_2</td>
                        <td id="T_7b74d_row3_col1" class="data row3 col1" >Default series</td>
                        <td id="T_7b74d_row3_col2" class="data row3 col2" >4</td>
                        <td id="T_7b74d_row3_col3" class="data row3 col3" >#728f02</td>
                        <td id="T_7b74d_row3_col4" class="data row3 col4" >4</td>
            </tr>
            <tr>
                        <th id="T_7b74d_level0_row4" class="row_heading level0 row4" >4</th>
                        <td id="T_7b74d_row4_col0" class="data row4 col0" >Main_Fault</td>
                        <td id="T_7b74d_row4_col1" class="data row4 col1" >Default series</td>
                        <td id="T_7b74d_row4_col2" class="data row4 col2" >5</td>
                        <td id="T_7b74d_row4_col3" class="data row4 col3" >#443988</td>
                        <td id="T_7b74d_row4_col4" class="data row4 col4" >5</td>
            </tr>
            <tr>
                        <th id="T_7b74d_level0_row5" class="row_heading level0 row5" >5</th>
                        <td id="T_7b74d_row5_col0" class="data row5 col0" >basement</td>
                        <td id="T_7b74d_row5_col1" class="data row5 col1" >Basement</td>
                        <td id="T_7b74d_row5_col2" class="data row5 col2" >1</td>
                        <td id="T_7b74d_row5_col3" class="data row5 col3" >#ff3f20</td>
                        <td id="T_7b74d_row5_col4" class="data row5 col4" >6</td>
            </tr>
    </tbody></table>
</div>
<br />
<br /><p>combine units in series and make two series, as the fault needs its own</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../GemPy API/gempy.map_stack_to_surfaces.html#gempy.map_stack_to_surfaces" title="gempy.map_stack_to_surfaces" class="sphx-glr-backref-module-gempy sphx-glr-backref-type-py-function"><span class="n">gp</span><span class="o">.</span><span class="n">map_stack_to_surfaces</span></a><span class="p">(</span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a><span class="p">,</span>
                         <span class="p">{</span><span class="s2">&quot;Fault_Series&quot;</span><span class="p">:</span> <span class="s1">&#39;Main_Fault&#39;</span><span class="p">,</span>
                          <span class="s2">&quot;Strat_Series&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Sandstone_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Siltstone&#39;</span><span class="p">,</span> <span class="s1">&#39;Shale&#39;</span><span class="p">,</span> <span class="s1">&#39;Sandstone_1&#39;</span><span class="p">,</span> <span class="s1">&#39;basement&#39;</span><span class="p">)},</span>
                         <span class="n">remove_unused_series</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># set the fault series to be fault object</span>
<a href="../Model/gempy.core.model.ImplicitCoKriging.html#gempy.core.model.ImplicitCoKriging.set_is_fault" title="gempy.core.model.ImplicitCoKriging.set_is_fault" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-method"><span class="n">geo_model</span><span class="o">.</span><span class="n">set_is_fault</span></a><span class="p">([</span><span class="s1">&#39;Fault_Series&#39;</span><span class="p">],</span> <span class="n">change_color</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>order_series</th>
      <th>BottomRelation</th>
      <th>isActive</th>
      <th>isFault</th>
      <th>isFinite</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Fault_Series</th>
      <td>1</td>
      <td>Fault</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Strat_Series</th>
      <td>2</td>
      <td>Erosion</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
<br />
<br /><p>check whether series were assigned correctly</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../Model/gempy.core.model.ImplicitCoKriging.html#gempy.core.model.ImplicitCoKriging.surfaces" title="gempy.core.model.ImplicitCoKriging.surfaces" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-method"><span class="n">geo_model</span><span class="o">.</span><span class="n">surfaces</span></a>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<style  type="text/css" >
#T_9fd1c_row0_col3{
            background-color:  #443988;
        }#T_9fd1c_row1_col3{
            background-color:  #015482;
        }#T_9fd1c_row2_col3{
            background-color:  #9f0052;
        }#T_9fd1c_row3_col3{
            background-color:  #ffbe00;
        }#T_9fd1c_row4_col3{
            background-color:  #728f02;
        }#T_9fd1c_row5_col3{
            background-color:  #ff3f20;
        }</style><table id="T_9fd1c_" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >surface</th>        <th class="col_heading level0 col1" >series</th>        <th class="col_heading level0 col2" >order_surfaces</th>        <th class="col_heading level0 col3" >color</th>        <th class="col_heading level0 col4" >id</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_9fd1c_level0_row0" class="row_heading level0 row0" >4</th>
                        <td id="T_9fd1c_row0_col0" class="data row0 col0" >Main_Fault</td>
                        <td id="T_9fd1c_row0_col1" class="data row0 col1" >Fault_Series</td>
                        <td id="T_9fd1c_row0_col2" class="data row0 col2" >1</td>
                        <td id="T_9fd1c_row0_col3" class="data row0 col3" >#443988</td>
                        <td id="T_9fd1c_row0_col4" class="data row0 col4" >1</td>
            </tr>
            <tr>
                        <th id="T_9fd1c_level0_row1" class="row_heading level0 row1" >0</th>
                        <td id="T_9fd1c_row1_col0" class="data row1 col0" >Shale</td>
                        <td id="T_9fd1c_row1_col1" class="data row1 col1" >Strat_Series</td>
                        <td id="T_9fd1c_row1_col2" class="data row1 col2" >1</td>
                        <td id="T_9fd1c_row1_col3" class="data row1 col3" >#015482</td>
                        <td id="T_9fd1c_row1_col4" class="data row1 col4" >2</td>
            </tr>
            <tr>
                        <th id="T_9fd1c_level0_row2" class="row_heading level0 row2" >1</th>
                        <td id="T_9fd1c_row2_col0" class="data row2 col0" >Sandstone_1</td>
                        <td id="T_9fd1c_row2_col1" class="data row2 col1" >Strat_Series</td>
                        <td id="T_9fd1c_row2_col2" class="data row2 col2" >2</td>
                        <td id="T_9fd1c_row2_col3" class="data row2 col3" >#9f0052</td>
                        <td id="T_9fd1c_row2_col4" class="data row2 col4" >3</td>
            </tr>
            <tr>
                        <th id="T_9fd1c_level0_row3" class="row_heading level0 row3" >2</th>
                        <td id="T_9fd1c_row3_col0" class="data row3 col0" >Siltstone</td>
                        <td id="T_9fd1c_row3_col1" class="data row3 col1" >Strat_Series</td>
                        <td id="T_9fd1c_row3_col2" class="data row3 col2" >3</td>
                        <td id="T_9fd1c_row3_col3" class="data row3 col3" >#ffbe00</td>
                        <td id="T_9fd1c_row3_col4" class="data row3 col4" >4</td>
            </tr>
            <tr>
                        <th id="T_9fd1c_level0_row4" class="row_heading level0 row4" >3</th>
                        <td id="T_9fd1c_row4_col0" class="data row4 col0" >Sandstone_2</td>
                        <td id="T_9fd1c_row4_col1" class="data row4 col1" >Strat_Series</td>
                        <td id="T_9fd1c_row4_col2" class="data row4 col2" >4</td>
                        <td id="T_9fd1c_row4_col3" class="data row4 col3" >#728f02</td>
                        <td id="T_9fd1c_row4_col4" class="data row4 col4" >5</td>
            </tr>
            <tr>
                        <th id="T_9fd1c_level0_row5" class="row_heading level0 row5" >5</th>
                        <td id="T_9fd1c_row5_col0" class="data row5 col0" >basement</td>
                        <td id="T_9fd1c_row5_col1" class="data row5 col1" >Strat_Series</td>
                        <td id="T_9fd1c_row5_col2" class="data row5 col2" >5</td>
                        <td id="T_9fd1c_row5_col3" class="data row5 col3" >#ff3f20</td>
                        <td id="T_9fd1c_row5_col4" class="data row5 col4" >6</td>
            </tr>
    </tbody></table>
</div>
<br />
<br /></div>
<div class="section" id="model-generation">
<h2>Model generation<a class="headerlink" href="#model-generation" title="Permalink to this headline">¶</a></h2>
<p>After loading in the data, we set it up for interpolation and compute
the model.</p>
<p>set up interpolator</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">gp</span><span class="o">.</span><span class="n">set_interpolator</span><span class="p">(</span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a><span class="p">,</span>
                    <span class="n">compile_theano</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">theano_optimizer</span><span class="o">=</span><span class="s1">&#39;fast_compile&#39;</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting kriging parameters to their default values.
Compiling theano function...
Level of Optimization:  fast_compile
Device:  cpu
Precision:  float64
Number of faults:  1
Compilation Done!
Kriging values:
                     values
range               3464.1
$C_o$            285714.29
drift equations     [3, 3]

&lt;gempy.core.interpolator.InterpolatorModel object at 0x7fcb8b722e50&gt;
</pre></div>
</div>
<p>compute the model</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../GemPy API/gempy.compute_model.html#gempy.compute_model" title="gempy.compute_model" class="sphx-glr-backref-module-gempy sphx-glr-backref-type-py-function"><span class="n">gp</span><span class="o">.</span><span class="n">compute_model</span></a><span class="p">(</span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a><span class="p">,</span> <span class="n">compute_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Lithology ids
  [6. 6. 6. ... 2. 2. 2.]
</pre></div>
</div>
<p>have a look at the data and computed model</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../Plot/gempy.plot_3d.html#gempy.plot_3d" title="gempy.plot_3d" class="sphx-glr-backref-module-gempy sphx-glr-backref-type-py-function"><span class="n">gp</span><span class="o">.</span><span class="n">plot_3d</span></a><span class="p">(</span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a><span class="p">)</span>
</pre></div>
</div>
<img alt="gempy export MOOSE" class="sphx-glr-single-img" src="../_images/sphx_glr_gempy_export_MOOSE_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;gempy.plot.vista.GemPyToVista object at 0x7fcb89256100&gt;
</pre></div>
</div>
</div>
<div class="section" id="exporting-the-model-to-moose">
<h2>Exporting the Model to MOOSE<a class="headerlink" href="#exporting-the-model-to-moose" title="Permalink to this headline">¶</a></h2>
<p>The voxel-model above already is the same as a model discretized in a
hexahedral grid, so my immediately be used as input in a simulation
tool, e.g. <a class="reference external" href="https://mooseframework.org/">MOOSE</a>. For this, we need to
access to the unit IDs assigned to each voxel in GemPy. The array
containing these IDs is called <code class="docutils literal notranslate"><span class="pre">lith_block</span></code>.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ids</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">lith_block</span></a>
<span class="nb">print</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ids</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[6. 6. 6. ... 2. 2. 2.]
</pre></div>
</div>
<p>This array has the shape of <code class="docutils literal notranslate"><span class="pre">(x,)</span></code> and would be immediately useful, if
GemPy and the chosen simulation code would <em>populate</em> a grid in the same
way. Of course, however, that is not the case. This is why we have to
restructure the <code class="docutils literal notranslate"><span class="pre">lith_block</span></code> array, so it can be read correctly by
MOOSE.</p>
<p>model resolution</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">nx</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">ny</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">nz</span></a> <span class="o">=</span> <a href="../Model/gempy.core.model.ImplicitCoKriging.html#gempy.core.model.ImplicitCoKriging.grid" title="gempy.core.model.ImplicitCoKriging.grid" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-method"><span class="n">geo_model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">regular_grid</span><span class="o">.</span><span class="n">resolution</span></a>

<span class="c1"># model extent</span>
<a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">xmin</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">xmax</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">ymin</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">ymax</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">zmin</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">zmax</span></a> <span class="o">=</span> <a href="../Model/gempy.core.model.ImplicitCoKriging.html#gempy.core.model.ImplicitCoKriging.grid" title="gempy.core.model.ImplicitCoKriging.grid" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-method"><span class="n">geo_model</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">regular_grid</span><span class="o">.</span><span class="n">extent</span></a>
</pre></div>
</div>
<p>These two parameters are important to, a) restructure <code class="docutils literal notranslate"><span class="pre">lith_block</span></code>,
and b) write the input file for MOOSE correctly. For a), we need to
reshape <code class="docutils literal notranslate"><span class="pre">lith_block</span></code> again to its three dimensions and <em>re-flatten</em> it
in a <em>MOOSE-conform</em> way.</p>
<p>reshape to 3D array</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">units</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ids</span></a><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">nx</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">ny</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">nz</span></a><span class="p">))</span>
<span class="c1"># flatten MOOSE conform</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">units</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">units</span></a><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The importance of <code class="docutils literal notranslate"><span class="pre">nx,</span> <span class="pre">ny,</span> <span class="pre">nz</span></code> is apparent from the cell above. But
what about <code class="docutils literal notranslate"><span class="pre">xmin</span></code>, …, <code class="docutils literal notranslate"><span class="pre">zmax</span></code>?</div>
<div class="line">A MOOSE input-file for mesh generation has the following syntax:</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MeshGenerators</span><span class="p">]</span>
  <span class="p">[</span><span class="o">./</span><span class="n">gmg</span><span class="p">]</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">GeneratedMeshGenerator</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">nx</span></a> <span class="o">=</span> <span class="mi">50</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">ny</span></a> <span class="o">=</span> <span class="mi">50</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.int64" title="numpy.int64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">nz</span></a> <span class="o">=</span> <span class="mi">80</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">xmin</span></a> <span class="o">=</span> <span class="mf">0.0</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">xmax</span></a> <span class="o">=</span> <span class="mf">2000.0</span>
    <span class="n">yim</span> <span class="o">=</span> <span class="mf">0.0</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">ymax</span></a> <span class="o">=</span> <span class="mf">2000.0</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">zmin</span></a> <span class="o">=</span> <span class="mf">0.0</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">zmax</span></a> <span class="o">=</span> <span class="mf">2000.0</span>
    <span class="n">block_id</span> <span class="o">=</span> <span class="s1">&#39;1 2 3 4 5 6&#39;</span>
    <span class="n">block_name</span> <span class="o">=</span> <span class="s1">&#39;Main_Fault Sandstone_2 Siltstone Shale Sandstone_1 basement&#39;</span>
  <span class="p">[</span><span class="o">../</span><span class="p">]</span>

  <span class="p">[</span><span class="o">./</span><span class="n">subdomains</span><span class="p">]</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">ElementSubdomainIDGenerator</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">gmg</span>
    <span class="n">subdomain_ids</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="c1"># here you paste the transformed lith_block vector</span>
  <span class="p">[</span><span class="o">../</span><span class="p">]</span>
<span class="p">[]</span>

<span class="p">[</span><span class="n">Mesh</span><span class="p">]</span>
  <span class="nb">type</span> <span class="o">=</span> <span class="n">MeshGeneratorMesh</span>
<span class="p">[]</span>
</pre></div>
</div>
<p>So these parameters are required inputs in the <code class="docutils literal notranslate"><span class="pre">[MeshGenerators]</span></code>
object in the MOOSE input file. <code class="docutils literal notranslate"><span class="pre">GemPy</span></code> has a method to directly
create such an input file, stored in <code class="docutils literal notranslate"><span class="pre">gempy.utils.export.py</span></code>.</p>
<p>The following cell shows how to call the method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_path = &#39;_static/GemPy_model_combined.png&#39;</span>
<span class="kn">import</span> <span class="nn">gempy.utils.export</span> <span class="k">as</span> <span class="nn">export</span>
<span class="n">export</span><span class="o">.</span><span class="n">export_moose_input</span><span class="p">(</span><a href="../Model/gempy.core.model.Project.html#gempy.core.model.Project" title="gempy.core.model.Project" class="sphx-glr-backref-module-gempy-core-model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">geo_model</span></a><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Successfully exported geological model as moose input to ./
</pre></div>
</div>
<p>This method automatically stores a file
<code class="docutils literal notranslate"><span class="pre">geo_model_units_moose_input.i</span></code> at the specified path. Either this
input file could be extended with parameters to directly run a
simulation, or it is used just for creating a mesh. In the latter case,
the next step would be, to run the compiled MOOSE executable witch the
optional flag <code class="docutils literal notranslate"><span class="pre">--mesh-only</span></code>.</p>
<p>E.g. with using the <a class="reference external" href="https://mooseframework.inl.gov/modules/porous_flow/">PorousFlow
module</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$path_to_moose</span>/moose/modules/porous_flow/porous_flow-opt -i pct_voxel_mesh.i --mesh-only
</pre></div>
</div>
<p>How to compile MOOSE is described in their
<a class="reference external" href="https://mooseframework.inl.gov/getting_started/index.html">documentation</a>.</p>
<p>The now generated mesh with the name
<code class="docutils literal notranslate"><span class="pre">geo_model_units_moose_input_in.e</span></code> can be used as input for another
MOOSE input file, which contains the main simulation parameters. To call
the file with the grid, the following part has to be added in the MOOSE
simulation input file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Mesh</span><span class="p">]</span>
  <span class="n">file</span> <span class="o">=</span> <span class="n">geo_model_units_moose_input_in</span><span class="o">.</span><span class="n">e</span>
<span class="p">[]</span>
</pre></div>
</div>
<hr><p>The final output of the simulation may also be such an <code class="docutils literal notranslate"><span class="pre">.e</span></code>, which
can, for instance, be opened with
<a class="reference external" href="https://www.paraview.org/">paraview</a>. A simulated temperature field
(purely conductive) of the created model would look like this:</p>
<div class="figure align-default">
<img alt="gempy_temperature" src="https://raw.githubusercontent.com/Japhiolite/a-Moose-and-you/master/imgs/GemPy_model_combined.png" />
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  8.698 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-integrations-gempy-export-moose-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b7b1d2f942d3b8b7a02b2a4813de1527/gempy_export_MOOSE.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">gempy_export_MOOSE.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/02037859fc66a2dc713f8b7500956670/gempy_export_MOOSE.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">gempy_export_MOOSE.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/./logos/gempy.png" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=cgre-aachen&repo=gempy&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/cgre-aachen/gempy">
    <img
        alt="https://secure.travis-ci.org/cgre-aachen/gempy.svg?branch=master"
        src="https://secure.travis-ci.org/cgre-aachen/gempy.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects.html">Additional projects</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">GemPy Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Integrations</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Export a geological model from GemPy to use in MOOSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="gempy_striplog.html">Transform 2019: Integrating Striplog and GemPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="gempy_subsurface.html">GemPy - Subsurface Link</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code.html">Code</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrations</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Integrations</a></li>
      <li>Next: <a href="gempy_striplog.html" title="next chapter">Transform 2019: Integrating Striplog and GemPy</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017-2021, CGRE-Aachen Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/integrations/gempy_export_MOOSE.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>